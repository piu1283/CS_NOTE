### 腾讯一面

> 时间： 08/17/2020

- 问题：
1. 介绍一下 raft 算法
2. raft 选主过程，主节点宕机之后会发生什么
3. 什么情况下会出现脑裂，raft 怎么保证这种情况下不会出现数据不一致
4. 有没有可能选举选不出来，怎么避免
5. java 中 gc 会不会影响程序运行
    - 会的，STW 总会发生的, 只是时间长短问题
    > 新生代的串行、PartNew，Part scavenge 收集器都需要stw。这些收集器中，串行肯定是停止用户线程的，并行和并发是有区别的，这里并行是指多个GC线程同时进行，用户线程还是需要被挂起。CMS里面有一个并发标记阶段是不需要stw的，和用户线程一起执行，但是初始标记和重新标记需要stw。

6. 如果一个程序很慢，怎么找到原因，怎么优化
    - https://testerhome.com/topics/23887
    - 分析所有 API 运行时间，找到对应的比较慢的 API.
    - 可以使用连接池自带的 SQL 执行时间统计来定位是不是数据库访问的问题
    - 如果不是再看是不是 JAVA GC 问题
    - 使用 jstat 查找各种代的 GC 次数统计
    > 重点关注一下几列：
    > YGC：年轻代垃圾回收次数  YGCT：年轻代垃圾回收消耗时间  FGC：老年代垃圾回收次数  FGCT：老年代垃圾回收消耗时间  GCT：垃圾回收消耗总时间
    - 然后使用 `java -Xmx1024m -verbose:gc` 展示详细 GC 时间
    - 有可能是内存泄露导致的频繁 GC
        - 内存泄露一般的情况：
        ```
        持续在堆上创建对象而不释放。例如，持续不断的往一个列表中添加对象，而不对列表清空。这种问题，通常可以给程序运行时添加 JVM 参数-Xmx 指定一个较小的运行堆大小，这样可以比较容易的发现这类问题。

        不正确的使用静态对象。因为 static 关键字修饰的对象的生命周期与 Java 程序的运行周期是一致的，所以垃圾回收机制无法回收静态变量引用的对象。所以，发生内存泄漏问题时，我们要着重分析所有的静态变量。

        对大 String 对象调用 String.intern()方法，该方法会从字符串常量池中查询当前字符串是否存在，若不存在就会将当前字符串放入常量池中。而在 jdk6 之前，字符串常量存储在 PermGen 区的，但是默认情况下 PermGen 区比较小，所以较大的字符串调用此方法，很容易会触发内存溢出问题。

        打开的输入流、连接没有争取关闭。由于这些资源需要对应的内存维护状态，因此不关闭会导致这些内存无法释放。
        ```
    - 对于内存泄露，可以使用 `top -c 命令查询 Java 高内存占用程序的进程 pid。然后使用 jcmd 命令获取进程中对象的计数、内存占用信息。`
7. jvm调优
8. spring IOC 是什么，做了什么，解决了什么问题
9. 进程间通讯方式
10. socket 发送接收过程
11. 计算机什么机制可以 "扩大" 物理内存
12. 开启一个进程会分配多大空间
13. 向操作系统申请空间的过程(maloc)，增量申请的过程(caloc)
14. Redis 跳表是什么
    - https://zhuanlan.zhihu.com/p/56941754
15. Redis 序列化方式
    - RDB 和 AOF 文件
16. 为什么说 Redis 突然宕机会丢失 1s 数据， 怎么解决
    - 丢失的原因是因为操作系统写入数据到磁盘是有缓存的，同时磁盘也有缓存
    - 默认情况下 redis 会将 AOF 写入操作缓存起来，然后每秒调用 fsync 写入磁盘
    - 可以修改配置让 redis 每次都调用 fsync 去写入磁盘, 但是这样会影响性能
17. MySQL 什么情况下需要建立索引
18. MySQL 为什么对列频繁修的列建立索引改会影响性能
19. MySQL 索引底层数据结构， B+树特点
20. 代码： LRU cache
21. 如果需要将你刚写的 cache 拿到公司里面用，需要有哪些修改（安全，易用，功能扩展）
